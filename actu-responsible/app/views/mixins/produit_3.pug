mixin produit__3(txt)
  - String.prototype.count=function(c) { var result = 0, i = 0; for(i;i<this.length;i++)if(this[i]==c)result++; return result };
  // start4products
  tr
    td
      table.product__all(align='center', cellpadding='0', cellspacing='0', border='0', width='98%')
        tbody
          tr
            each produit in txt
              - var finalUrl = baseUrl + produit.link + meta
              - var occurence = finalUrl.count('?');
              - //console.log(occurence, 'occurence', finalUrl, 'finalurl')
              while (Ocurrence > 1 )
                - var t=0; 
                - finalUrl = finalUrl.replace(/\?/g, function (match) {t++; return (t === 2) ? "&" : match; })
                - Ocurrence--;
              if (finalUrl.indexOf('redirect') !== -1 &&  finalUrl.indexOf('sort') !== -1)
              - finalUrl.replace("&sort", "?sort");  
              td.products__unit.products__unit--big(width='25%', align='center')
                table.products__body(align='center', cellpadding='0', cellspacing='0', border='0', width='100%')
                  tbody
                    tr.products__promo
                      td
                        table.products__promo(height='25', align='center', cellpadding='0', cellspacing='0', border='0', width='100%')
                          tbody
                            tr
                              if produit.promo__title == 'none'
                                td(width='100%', align='center') &nbsp;
                              else if produit.promo__title == 'big'
                                td( style='background-color: #fc5d6a; color:white; ' width='100%', align='center')!= produit.promo__value
                              else
                                td(width='60%', align='center')!= produit.promo__title 
                                td(width='40%', align='center')!= produit.promo__value                        
                    tr
                      td.products__blank  
                    tr
                      td(align='center')
                        a(href=  finalUrl, target='_blank')
                          img(alt= produit.alt, src=produit.img, width='100', height='100', border='0', style='display:block')
                    tr
                      td.products__blank  
                    tr
                      td.products__txt(align='center', width='100%')!= produit.name
                        br
                    tr
                      td.products__btn(align='center', width='100%', style='border-collapse: collapse; mso-line-height-rule: exactly;')
                        table(border='0', cellspacing='0', cellpadding='0', align='center', width='100%', style='border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt;')
                          tr
                            td(align='center', width='100%', style=' border-collapse: collapse; mso-line-height-rule: exactly;')
                              != "<!--[if mso]>"
                              v:roundrect(xmlns:v='urn:schemas-microsoft-com:vml', xmlns:w='urn:schemas-microsoft-com:office:word', href=  finalUrl, style='height:30px;v-text-anchor:middle;width:200px;', arcsize='5%', strokecolor='#52c47d', fillcolor='#52c47d')
                                w:anchorlock
                                  center(style='color:#fff;font-family:Helvetica, Arial,sans-serif;font-size:14px;')!= produit.btn
                              != "<![endif]-->"
                              a(href=  finalUrl, style=' font-family:Arial,Helvetica,sans-serif;background-color: #52c47d; border: 1px solid #52c47d; border-radius: 3px; color: #fff; display: inline-block; font-family: sans-serif; font-size: 14px; line-height: 30px; text-align: center; text-decoration: none; width: 95%; -webkit-text-size-adjust: none; mso-hide: all; font-weight: bold;')!= produit.btn
                    tr
                      td.products__blank 
  // end4products